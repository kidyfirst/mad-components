define(function(t,s,i){var o=t("../../util/util"),n=function(t,s,i){this.container=t,this.options={label:"数量",defaultValue:1,maxAmount:10,minAmount:1,realCheck:!1,disableClass:"dis",addClass:"add",showHandelChar:!0},o.fn.extend(this.options,s),this.isValid(this.options.defaultValue)||(this.options.defaultValue=this.options.minAmount),this.html='<div class="mad-ui-controlinput">'+(this.options.label?'<label class="control-label">{label}</label>':"")+'<div class="controls"><div class="duration"><a href="javascript:void(0);" class="icon-reduce {reduceClass}">'+(this.options.showHandelChar?"-":"")+'</a><div class="dur-ipt focus"><input type="text" pattern="[0-9]*" type="tel" value="{defaultValue}" maxlength="'+String(this.options.maxAmount).length+'"></div><a href="javascript:void(0);" class="icon-increase" {addClass}>'+(this.options.showHandelChar?"+":"")+"</a></div></div></div>",this.callbacks={},o.fn.extend(this.callbacks,i),this._init(),this._bindEvent()};n.prototype={_init:function(){var t=o.string.format(this.html,{defaultValue:this.options.defaultValue,label:this.options.label,reduceClass:this.options.defaultValue<=this.options.minAmount?this.options.disableClass:"",addClass:this.options.defaultValue>=this.options.maxAmount?this.options.disableClass:""}),s=o.dom.toDom(t);this.container.appendChild(s),this.inputDom=o.$("input",s),this.addDom=o.$(".icon-increase",s),this.reduceDom=o.$(".icon-reduce",s),this.callbacks.onSelect&&this.callbacks.onSelect(this.options.defaultValue)},getValue:function(){return parseFloat(this.inputDom.value)},setValue:function(t){this.isValid(t)?(this.inputDom.value=t,t!=this.options.defaultValue&&(this.options.defaultValue=t,this.callbacks.onSelect&&this.callbacks.onSelect(this.options.defaultValue)),t<=this.options.minAmount?(o.dom.removeClass(this.addDom,this.options.disableClass),o.dom.addClass(this.reduceDom,this.options.disableClass)):t>=this.options.maxAmount?(o.dom.removeClass(this.reduceDom,this.options.disableClass),o.dom.addClass(this.addDom,this.options.disableClass)):(o.dom.removeClass(this.reduceDom,this.options.disableClass),o.dom.removeClass(this.addDom,this.options.disableClass))):t<this.options.minAmount?this.setValue(this.options.minAmount):t>this.options.maxAmount&&this.setValue(this.options.maxAmount)},isValid:function(t){return t="undefined"!=typeof t?t:this.getValue(),t&&t>=this.options.minAmount&&t<=this.options.maxAmount},_bindEvent:function(){var t=this,s=function(s){var i=t.getValue(),o=s?i+1:i-1;t.setValue(o)};if(this.options.supportTouch){var i="ontouchstart"in window,n=i?"touchstart":"mousedown",e=i?"touchend":"mouseup",a=function(t){s(t),o.fn.delayRun("inputControl",function(){a(t)},200)},l=function(){o.fn.delayRun("inputControl",function(){},0)};o.event.on(this.addDom,n,function(t){t.preventDefault(),a(!0)}),o.event.on(this.reduceDom,n,function(t){t.preventDefault(),a()}),o.event.on(this.addDom,e,function(){l()}),o.event.on(this.reduceDom,e,function(){l()})}else o.event.on(this.addDom,"click",function(){s(!0)}),o.event.on(this.reduceDom,"click",function(){s()});var u=o.ua.iOS?"input":"keyup";o.event.on(this.inputDom,u,function(){if(this.value.length>0){var s=o.number.convertToNumber(this.value);t.options.realCheck?t.setValue(s):t.value=s}}),o.event.on(this.inputDom,"blur",function(){var s=o.number.convertToNumber(this.value);t.setValue(s)}),o.event.on(this.inputDom,"focus",function(){t.callbacks.onFocus&&t.callbacks.onFocus(this)})}},i.exports=s=n});